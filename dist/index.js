parcelRequire=function(e,r,n){var t="function"==typeof parcelRequire&&parcelRequire,i="function"==typeof require&&require;function u(n,o){if(!r[n]){if(!e[n]){var f="function"==typeof parcelRequire&&parcelRequire;if(!o&&f)return f(n,!0);if(t)return t(n,!0);if(i&&"string"==typeof n)return i(n);var c=new Error("Cannot find module '"+n+"'");throw c.code="MODULE_NOT_FOUND",c}a.resolve=function(r){return e[n][1][r]||r};var l=r[n]=new u.Module(n);e[n][0].call(l.exports,a,l,l.exports)}return r[n].exports;function a(e){return u(a.resolve(e))}}u.isParcelRequire=!0,u.Module=function(e){this.id=e,this.bundle=u,this.exports={}},u.modules=e,u.cache=r,u.parent=t;for(var o=0;o<n.length;o++)u(n[o]);return u}({4:[function(require,module,exports) {
const E=0,A=1,_=24,I=2432,D=12,S=28;module.exports={BIG_ENDIAN:0,LITTLE_ENDIAN:1,FILE_HEADER_SIZE:24,RADAR_DATA_SIZE:2432,CTM_HEADER_SIZE:12,MESSAGE_HEADER_SIZE:28};
},{}],5:[function(require,module,exports) {
const t=require("fs");var e=require("../constants");const s=e.BIG_ENDIAN;class f{constructor(t){return this.offset=0,this.buffer=null,this.bigEndian=!1,new Promise(e=>{this.loadFile(t).then(t=>{this.buffer=Buffer.from(t,"binary"),e(this)})})}getLength(){return this.buffer.length}loadFile(e){return new Promise(s=>{t.readFile(e,(t,e)=>{s(e)})})}seek(t){this.offset=t}endianOrder(t){t<0||(this.bigEndian=t===s)}readString(t){return this.buffer.toString("utf-8",this.offset,this.offset+=t)}readFloat(){let t=this.bigEndian?this.buffer.readFloatBE(this.offset):this.buffer.readFloatLE(this.offset);return this.offset+=4,t}readInt(){let t=this.bigEndian?this.buffer.readIntBE(this.offset,4):this.buffer.readIntLE(this.offset,4);return this.offset+=4,t}readShort(){let t=this.bigEndian?this.buffer.readIntBE(this.offset,2):this.buffer.readIntLE(this.offset,2);return this.offset+=2,t}readByte(){return this.read()}read(t=1){let e=null;return t>1?(e=this.buffer.slice(this.offset,t),this.offset+=t):(e=this.buffer[this.offset],this.offset++),e}skip(t){this.offset+=t}}module.exports.RandomAccessFile=f;
},{"../constants":4}],7:[function(require,module,exports) {
var t=require("../constants");const s=t.MESSAGE_HEADER_SIZE;class r{constructor(t=null,s=null,r=null){this._raf=t,this._dbp=s,this._record_offset=r}setRaf(t){this._raf=t}setDataBlockPointer(t){this._dbp=t}setRecordOffset(t){this._record_offset=t}getDataBlockByte(t){return this._raf.seek(this._dbp+this._record_offset+s),this._raf.skip(t),this._raf.read()}getDataBlockInt(t){return this._raf.seek(this._dbp+this._record_offset+s),this._raf.skip(t),this._raf.readInt()}getDataBlockBytes(t,r){return this._raf.seek(this._dbp+this._record_offset+s),this._raf.skip(t),this._raf.read(r)}getDataBlockShort(t){return this._raf.seek(this._dbp+this._record_offset+s),this._raf.skip(t),this._raf.readShort()}getDataBlockFloat(t){return this._raf.seek(this._dbp+this._record_offset+s),this._raf.skip(t),this._raf.readFloat()}getDataBlockString(t,r){return this._raf.seek(this._dbp+this._record_offset+s),this._raf.skip(t),this._raf.readString(r)}}module.exports.Level2Parser=r;
},{"../constants":4}],6:[function(require,module,exports) {
var e=require("./Level2Parser");const t=e.Level2Parser;var a=require("../constants");const r=a.MESSAGE_HEADER_SIZE,o=a.FILE_HEADER_SIZE,l=a.RADAR_DATA_SIZE,s=a.CTM_HEADER_SIZE;class d{constructor(e,t,a){return this._record_offset=t*l+o+a,this._record_offset>=e.getLength()?{finished:!0}:this._getRecord(e)}_parseVolumeData(e,a,r){let o=new t(e,r,this._record_offset),l={block_type:o.getDataBlockString(0,1),name:o.getDataBlockString(1,3),size:o.getDataBlockShort(4),version_major:o.getDataBlockByte(6),version_miner:o.getDataBlockByte(7),latitude:o.getDataBlockFloat(8),longitude:o.getDataBlockFloat(12),elevation:o.getDataBlockShort(16),feedhorn_height:o.getDataBlockByte(18),calibration:o.getDataBlockFloat(20),tx_horizontal:o.getDataBlockFloat(24),tx_vertical:o.getDataBlockFloat(28),differential_reflectivity:o.getDataBlockFloat(32),volume_coverage_pattern:o.getDataBlockByte(40)};a.volume=l}_parseElevationData(e,a,r){let o=new t(e,r,this._record_offset),l={block_type:o.getDataBlockString(0,1),name:o.getDataBlockString(1,3),size:o.getDataBlockShort(4),atmos:o.getDataBlockShort(6),calibration:o.getDataBlockFloat(8)};a.elevation=l}_parseRadialData(e,a,r){let o=new t(e,r,this._record_offset),l={block_type:o.getDataBlockString(0,1),name:o.getDataBlockString(1,3),size:o.getDataBlockShort(4),unambiguous_range:o.getDataBlockShort(6),horizontal_noise_level:o.getDataBlockFloat(8),vertical_noise_level:o.getDataBlockFloat(12),nyquist_velocity:o.getDataBlockShort(16)};a.radial=l}_parseMomentData(e,a,r,o){if(r>0){let l=new t(e,r,this._record_offset),s={gate_count:l.getDataBlockShort(8),first_gate:l.getDataBlockShort(10)/1e3,gate_size:l.getDataBlockShort(12)/1e3,rf_threshold:l.getDataBlockShort(14)/10,snr_threshold:l.getDataBlockShort(16)/1e3,data_size:l.getDataBlockByte(19),scale:l.getDataBlockFloat(20),offset:l.getDataBlockFloat(24),data_offset:r+28,moment_data:[]};switch(o){case"REF":for(let e=28;e<=1867;e++)s.moment_data.push((l.getDataBlockByte(e)-s.offset)/s.scale);a.reflect=s;break;case"VEL":for(let e=28;e<=1227;e++)s.moment_data.push((l.getDataBlockByte(e)-s.offset)/s.scale);a.velocity=s;break;case"SW":for(let e=28;e<=1227;e++)s.moment_data.push((l.getDataBlockByte(e)-s.offset)/s.scale);a.spectrum=s;break;case"ZDR":for(let e=28;e<=1227;e++)s.moment_data.push((l.getDataBlockByte(e)-s.offset)/s.scale);a.zdr=s;break;case"RHO":for(let e=28;e<=1227;e++)s.moment_data.push((l.getDataBlockByte(e)-s.offset)/s.scale);a.rho=s}}}_getRecord(e){e.seek(this._record_offset),e.skip(s);let t={message_size:e.readShort(),channel:e.readByte(),message_type:e.readByte(),id_sequence:e.readShort(),message_julian_date:e.readShort(),message_mseconds:e.readInt(),segment_count:e.readShort(),segment_number:e.readShort()};if(31==t.message_type){t.record={id:e.readString(4),mseconds:e.readInt(),julian_date:e.readShort(),radial_number:e.readShort(),azimuth:e.readFloat(),compress_idx:e.readByte(),sp:e.readByte(),radial_length:e.readShort(),ars:e.readByte(),rs:e.readByte(),elevation_number:e.readByte(),cut:e.readByte(),elevation:e.readFloat(),rsbs:e.readByte(),aim:e.readByte(),dcount:e.readShort()};let a=e.readInt(),r=e.readInt(),o=e.readInt(),l=e.readInt(),s=e.readInt(),d=e.readInt(),c=e.readInt(),_=e.readInt(),n=e.readInt();this._parseVolumeData(e,t.record,a),this._parseElevationData(e,t.record,r),this._parseRadialData(e,t.record,o),this._parseMomentData(e,t.record,l,"REF"),this._parseMomentData(e,t.record,s,"VEL"),this._parseMomentData(e,t.record,d,"SW"),this._parseMomentData(e,t.record,c,"ZDR"),this._parseMomentData(e,t.record,_,"PHI"),this._parseMomentData(e,t.record,n,"RHO")}return 1==t.message_type&&(t.record={mseconds:e.readInt(),julian_date:e.readShort(),range:e.readShort(),azmith_angle:e.readShort(),radial_number:e.readShort(),radial_status:e.readShort(),elevation_angle:e.readShort(),elevation_number:e.readShort(),reflect_first_gate:e.readShort(),doppler_first_gate:e.readShort(),reflect_gate_size:e.readShort(),doppler_gate_size:e.readShort(),reflect_gate_count:e.readShort(),doppler_gate_count:e.readShort(),cut:e.readShort(),calibration:e.readFloat(),reflect_offset:e.readShort(),velocity_offset:e.readShort(),width_offset:e.readShort(),resolution:e.readShort(),vcp:e.readShort()},e.skip(14),t.record.nyquist_vel=e.readShort(),t.record.attenuation=e.readShort(),t.record.threshold=e.readShort(),t.record.has_reflection_data=t.record.reflect_gate_count>0,t.record.has_doppler_data=t.record.doppler_gate_count>0),t}}module.exports.Level2Record=d;
},{"./Level2Parser":7,"../constants":4}],3:[function(require,module,exports) {
var e=require("./classes/RandomAccessFile");const t=e.RandomAccessFile;var r=require("./classes/Level2Record");const s=r.Level2Record;var i=require("./constants");const a=i.BIG_ENDIAN,n=i.FILE_HEADER_SIZE;class o{constructor(e){return this.elevation=0,this.scan=0,new Promise(t=>{this.parseData(e).then(()=>{t(this)})})}setElevation(e){this.elevation=e-1}setScan(e){this.scan=e-1}setSweep(e){this.setScan(e)}getAzimuth(e){return e?this.data[this.elevation][e].record.azimuth:null}getScans(){return this.data[this.elevation].length}getHighresReflectivity(e){if(e)return this.data[this.elevation][e].record.reflect;{let e=[];for(let t=0;t<this.data[this.elevation].length;t++)e.push(this.data[this.elevation][t].record.reflect);return e}}getHighresVelocity(){return this.data[this.elevation][this.scan].record.velocity}getHighresSpectrum(){return this.data[this.elevation][this.scan].record.spectrum}getHighresDiffReflectivity(){return this.data[this.elevation][this.scan].record.zdr}getHighresDiffPhase(){return this.data[this.elevation][this.scan].record.phi}getHighresCorrelationCoefficient(){return this.data[this.elevation][this.scan].record.rho}parseData(e){return new Promise(r=>{new t(e).then(e=>{let t=[];e.endianOrder(a),e.seek(n);let i=0,o=0;for(;;){let r=new s(e,o++,i);if(r.finished)break;31===r.message_type&&(i+=2*r.message_size+12-2432),1!=r.message_type&&31!=r.message_type||(r.record.reflect&&t.push(r),r.record.velocity&&t.push(r),r.record.spectrum&&t.push(r),r.record.zdr&&t.push(r),r.record.phi&&t.push(r),r.record.rho&&t.push(r))}this.data=this.groupAndSortScans(t),r(!0)})})}groupAndSortScans(e){let t=[];return e.map(e=>{let r=e.record.elevation_number;t[r+""]?t[r+""].push(e):t[r+""]=[e]}),t=t.sort((e,t)=>{let r=e[0].record.elevation_number,s=t[0].record.elevation_number;return r>s?1:r<s?-1:0})}}module.exports.Level2Radar=o;
},{"./classes/RandomAccessFile":5,"./classes/Level2Record":6,"./constants":4}],1:[function(require,module,exports) {
"use strict";var e=require("@tensorflow/tfjs"),t=i(e);function i(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}const a=require("express"),r=a(),n=require("http").Server(r),s=require("socket.io")(n);var l=require("../nexrad");const o=l.Level2Radar;let d=null,c=!1;Math.radians=function(e){return e*Math.PI/180},r.use("/",a.static(__dirname+"/public")),r.get("/",(e,t)=>{t.sendFile(__dirname+"/public/index.html")}),s.on("connection",e=>{e.on("loadFile",t=>{e.emit("fileLoading",!0),c=!0,d=new o(t).then(t=>{d=t,c=!1,e.emit("fileLoading",!1),e.emit("setScans",t.getScans())})}),e.on("setElevation",t=>{d?d.setElevation(t):e.emit("error",{message:"No file loaded"})}),e.on("sweep",i=>{if(d){let a=d.getHighresReflectivity(i),r=t.scalar(Math.radians(d.getAzimuth(i))),n=t.range(0,a.gate_count,1).mul(t.scalar(a.gate_size)).add(t.scalar(a.first_gate)),s=n.mul(t.sin(r)),l=n.mul(t.cos(r));s.data().then(t=>{let i={x:JSON.stringify(t)};l.data().then(t=>{i.y=JSON.stringify(t);let r=a.moment_data;e.emit("plot",{coords:i,data:r})})})}else e.emit("error",{message:"No file loaded"})})}),n.listen(3e3,()=>{console.log("Listening on *:3000")});
},{"../nexrad":3}]},{},[1])
//# sourceMappingURL=/index.map